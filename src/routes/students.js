import { Router } from 'express';
import {
  createStudentController,
  deleteStudentByIdController,
  getStudentByIdController,
  getStudentsController,
  updateStudentByIdController,
} from '../controllers/students.js';
import { celebrate } from 'celebrate';
import { createStudentValidationSchema } from '../validation/createStudentValidationSchema.js';
import { studentIdValidationSchema } from '../validation/studentIdValidationSchema.js';
import { updateStudentValidationSchema } from '../validation/updateStudentValidationSchema.js';
import { getStudentsValidationSchema } from '../validation/getStudentsValidationSchema.js';
import { authenticate } from '../middlewares/authenticate.js';

const studentsRouter = Router();

studentsRouter.use('/students', authenticate);

studentsRouter.use(
  '/students/:studentId',
  celebrate(studentIdValidationSchema),
);

studentsRouter.get(
  '/students',
  celebrate(getStudentsValidationSchema),
  getStudentsController,
);

studentsRouter.get('/students/:studentId', getStudentByIdController);

studentsRouter.post(
  '/students',
  celebrate(createStudentValidationSchema, {
    abortEarly: false,
  }),
  createStudentController,
);

studentsRouter.patch(
  '/students/:studentId',
  celebrate(updateStudentValidationSchema, {
    abortEarly: false,
  }),
  updateStudentByIdController,
);

studentsRouter.delete('/students/:studentId', deleteStudentByIdController);

export default studentsRouter;
